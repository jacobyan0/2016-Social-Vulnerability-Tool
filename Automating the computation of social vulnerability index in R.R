#Set up the workspace (replace "jacobyan" below with your user name.)

setwd("C:\\Users\\Jacob Yan\\Desktop\\Social Vunerability")

#Loading Tables downloaded from AmericanFactfinder into R

B02001<-read.csv("ACS_14_5YR_B02001_with_ann.csv")
B01001<-read.csv("ACS_14_5YR_B01001_with_ann.csv")
B23025<-read.csv("ACS_14_5YR_B23025_with_ann.csv")
B25044<-read.csv("ACS_14_5YR_B25044_with_ann.csv")
C17002<-read.csv("ACS_14_5YR_C17002_with_ann.csv")
B27010<-read.csv("ACS_14_5YR_B27010_with_ann.csv")
B15003<-read.csv("ACS_14_5YR_B15003_with_ann.csv")
B25002<-read.csv("ACS_14_5YR_B25002_with_ann.csv")
B25003<-read.csv("ACS_14_5YR_B25003_with_ann.csv")
B25070<-read.csv("ACS_14_5YR_B25070_with_ann.csv")
B25091<-read.csv("ACS_14_5YR_B25091_with_ann.csv")
B16002<-read.csv("ACS_14_5YR_B16002_with_ann.csv")
B18101<-read.csv("ACS_14_5YR_B18101_with_ann.csv")
FoodAcc <- read.csv("")

#Calculate the indicators

#Indicator 1: % non-white, noted as NonWhite
NonWhite <- (B02001$HD01_VD01 - B02001$HD01_VD02) / B02001$HD01_VD01

#Indicator 2: % under 17 + % over 65 , noted as Under17_Over65
Under17_Over65 <- (B01001$HD01_VD03 + B01001$HD01_VD04 + B01001$HD01_VD05 + B01001$HD01_VD06 + B01001$HD01_VD20 + B01001$HD01_VD21 +
                     B01001$HD01_VD22 + B01001$HD01_VD23 + B01001$HD01_VD24 + B01001$HD01_VD25 + B01001$HD01_VD27 + B01001$HD01_VD28 +
                     B01001$HD01_VD29 + B01001$HD01_VD30 + B01001$HD01_VD44 + B01001$HD01_VD45 + B01001$HD01_VD46 + B01001$HD01_VD47 + 
                     B01001$HD01_VD48 + B01001$HD01_VD49) / B01001$HD01_VD01

#Indicator 3: % unemployment , noted as Unemployed
Unemployed <- B23025$HD01_VD05 / B23025$HD01_VD03

#Indicator 4: % with zero vehicle, noted as NoVehicle
NoVehicle <- (B25044$HD01_VD03 + B25044$HD01_VD10) / B25044$HD01_VD01

#Indicator 5: % Population in poverty , noted as Poverty
Poverty <- (C17002$HD01_VD02 + C17002$HD01_VD03) / C17002$HD01_VD01

#Indicator 6: % without health insurance , noted as NoHealthIns
NoHealthIns <- (B27010$HD01_VD17 + B27010$HD01_VD33 + B27010$HD01_VD50 + B27010$HD01_VD66) / B27010$HD01_VD01 

#Indicator 7: % less than high school diploma , noted as LessHighSch
LessHighSch <-(B15003$HD01_VD02 + B15003$HD01_VD03 + B15003$HD01_VD04 + B15003$HD01_VD05 + B15003$HD01_VD06 + B15003$HD01_VD07 + 
                 B15003$HD01_VD08 + B15003$HD01_VD09 + B15003$HD01_VD10 + B15003$HD01_VD011 + B15003$HD01_VD12 + B15003$HD01_VD13 + B15003$HD01_VD14 + 
                 B15003$HD01_VD15 + B15003$HD01_VD16) / B15003$HD01_VD01

#Indicator 8: % Vacant , noted as Vacant
Vacant <- B25002$HD01_VD03 / B25002$HD01_VD01

#Indicator 9: % Rental, noted as Rental 
Rental <- B25003$HD01_VD03 / B25003$HD01_VD01

#Indicator 10: % Renter households paying more than 30% of their income, noted as Rental30Inc 
Renter30Inc <-((B25070$HD02_VD07 + B25070$HD02_VD08 + B25070$HD02_VD09 + B25070$HD02_VD10) / B25070$HD01_VD01)

#Indicator 11: % Owner households paying more than 30% of their income, noted as Owner30Inc 
Owner30Inc <-((B25091$HD01_VD08 + B25091$HD01_VD09 + B25091$HD01_VD10 + B25091$HD01_VD11 + B25091$HD01_VD19 + B25091$HD01_VD20 + 
                 B25091$HD01_VD21 + B25091$HD01_VD22) / B25091$HD01_VD01)

#Indicator 12: % limited English Speaking Households, noted as LimEnglish
LimEnglish <-(B16002$HD01_VD04 + B16002$HD01_VD07 + B16002$HD01_VD10 + B16002$HD01_VD13) / B16002$HD01_VD01

#Indicator 13: % pple more than 5 years old with a disability, noted as Disab_Over5
Disab_Over5 <-(B18101$HD01_VD04 + B18101$HD01_VD07 + B18101$HD01_VD10 + B18101$HD01_VD13 + B18101$HD01_VD16 + B18101$HD01_VD19 + B18101$HD01_VD23 + 
                 B18101$HD01_VD26 + B18101$HD01_VD29 + B18101$HD01_VD32 + B18101$HD01_VD35 + B18101$HD01_VD38) / B18101$HD01_VD01

#Indicator 14: Food Access,
FoodAcc

#Converting the values of indicators into Z-scores

Z_NonWhite <- (NonWhite - mean(NonWhite))/sd(NonWhite)
Z_Under17_Over65 <- (Under17_Over65 - mean(Under17_Over65))/sd(Under17_Over65)
Z_Unemployed <- (Unemployed - mean(Unemployed))/sd(Unemployed)
Z_NoVehicle <- (NoVehicle - mean(NoVehicle))/sd(NoVehicle)
Z_Poverty <- (Poverty - mean(Poverty))/sd(Poverty)
Z_NoHealthIns <- (NoHealthIns - mean(NoHealthIns))/sd(NoHealthIns)
Z_LessHighSch <- (LessHighSch - mean(LessHighSch))/sd(LessHighSch)
Z_Vacant <- (Vacant - mean(Vacant))/sd(Vacant)
Z_Rental <- (Rental - mean(Rental))/sd(Rental)
Z_Renter30Inc <- (Renter30Inc - mean(Renter30Inc))/sd(Renter30Inc)
Z_Owner30Inc <- (Owner30Inc - mean(Owner30Inc))/sd(Owner30Inc)
Z_LimEnglish <- (LimEnglish - mean(LimEnglish))/sd(LimEnglish)
Z_Disab_Over5 <- (Disab_Over5 - mean(Disab_Over5))/sd(Disab_Over5)

#Calculate the Vunerability Index Score
[Weighting : two options. Option 1: assigning weight by changing the formula below]
Vul_Score <- Z_NonWhite + Z_Under17_Over65 + Z_Unemployed + Z_NoVehicle + Z_Poverty + Z_NoHealthIns + Z_LessHighSch
+ Z_Vacant + Z_Rental + Z_Renter30Inc + Z_Owner30Inc + Z_LimEnglish + Z_Disab_Over5

#Writing the intermediate results (indicators) and final result (vulnerability score) into an output table
Output <- read.csv("Output.csv")
Output$GEO.id <- B02001$GEO.id
Output$Z_NonWhite <- Z_NonWhite
Output$Z_Under17_Over65 <- Z_Under17_Over65 
Output$Z_Unemployed <- Z_Unemployed
Output$Z_NoVehicle <- Z_NoVehicle
Output$Z_Poverty <- Z_Poverty
Output$Z_NoHealthIns <- Z_NoHealthIns
Output$Z_LessHighSch <- Z_LessHighSch
Output$Z_Vacant <- Z_Vacant
Output$Z_Rental <- Z_Rental
Output$Z_Renter30Inc <- Z_Renter30Inc
Output$Z_Owner30Inc <- Z_Owner30Inc
Output$Z_LimEnglish <- Z_LimEnglish
Output$Z_Disab_Over5 <- Z_Disab_Over5
write.csv(Output,"Result.csv")

